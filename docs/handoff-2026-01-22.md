# Legislative Intelligence System - Handoff Document

**Date**: 2026-01-22
**Status**: POC functional, needs UI/UX polish and bug fixes

## Project Overview

This is a **Legislative Intelligence System** POC focused on the CHIPS and Science Act. It uses Neo4j (hosted on Aura), FastAPI, and Claude-powered narrative generation to make legislation navigable and understandable.

**Live Production**: https://legislative-intelligence-production.up.railway.app/ui
**GitHub**: https://github.com/elcontad0r/legislative-intelligence

## Current Architecture

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│   FastAPI       │────▶│   Neo4j Aura    │     │   Anthropic     │
│   (Railway)     │     │   (Graph DB)    │     │   Claude API    │
└────────┬────────┘     └─────────────────┘     └────────┬────────┘
         │                                               │
         │              ┌─────────────────┐              │
         └─────────────▶│   Jinja2 HTML   │◀─────────────┘
                        │   (Single Page) │
                        └─────────────────┘
```

## Credentials

**Neo4j Aura**:
- URI: `neo4j+s://e7a8cfe8.databases.neo4j.io`
- User: `neo4j`
- Password: `NHHlBSq44JEheHQIGABcBAC74G-Ej6FPOjJYPSqJKNw`

**Railway**: Deploys automatically from GitHub. If you need to restart, Austin can do it from the Railway dashboard or run `railway login` interactively.

## What Was Fixed (2026-01-22 Session)

1. **Section names in Aura** - The migration script used wrong property name (`s.name` vs `s.section_name`). Fixed and ran `scripts/fix_section_names_aura.py` to populate 6,651 section names.

2. **Most Amended query** - Was showing random heavily-amended Medicare sections. Fixed to only show sections CHIPS actually touched (`src/api/narrative_endpoints.py` lines 137-148).

3. **Clickable Key Provisions** - Bold text in provisions now links to relevant topic sections (`src/web/templates/index.html` lines 355-429).

4. **Search functionality** - Added search bar with debounced API search (`src/web/templates/index.html` lines 534-611).

5. **Cache issue** - Production had stale empty cache. Fixed by redeploying Railway.

## Known Issues to Fix

### HIGH PRIORITY - Data/API Issues

1. **Section modal errors** - Clicking on section titles often fails to load content. The `/narrative/section/{citation}` endpoint may be:
   - Timing out on LLM generation
   - Failing silently and returning empty
   - Having cache issues similar to what we just fixed

   Check `src/api/narrative_endpoints.py` lines 339-425 for the `get_section_context` function.

2. **Topic classification still has "Other" bucket** - 77 sections are in "Other" because the keyword matching in `src/narrative/generator.py` `_group_sections_by_topic()` (lines 1235-1283) isn't catching them. Need to:
   - Expand TOPIC_KEYWORDS dict
   - Maybe use LLM for better classification
   - Or analyze what's in "Other" and add appropriate keywords

3. **Empty section names in some places** - Some sections still show as "Unknown" or empty in the UI modals despite the bulk fix. May need to check if the section lookup is using cached data.

### MEDIUM PRIORITY - UI/UX Issues

4. **Overall UI polish** - The council feedback document (`docs/council-feedback-2026-01-22.md`) has detailed suggestions:
   - Distinguish AI-generated content from source data visually
   - Add links to primary sources (USC, Congress.gov)
   - Better mobile responsiveness
   - Loading states need improvement
   - Error handling/messaging is poor

5. **Pathways not fully functional** - The "Start Here" pathways show section citations but clicking them may not work properly.

6. **Search results UX** - Works but could be better:
   - No keyboard navigation
   - Results don't highlight matching text
   - Could add filters (by topic, by title)

### LOWER PRIORITY - Features from Council Feedback

7. **Primary source links** - Add links to:
   - uscode.house.gov for USC sections
   - congress.gov for Public Laws
   - The provenance data exists in Neo4j (`source_url` property)

8. **Visual distinction for AI content** - Council strongly recommended making it clear what's LLM-generated vs source data. Could use different styling/icons.

9. **Timeline interactivity** - The timeline section exists but isn't very useful yet.

10. **Export/sharing** - No way to share specific views or export content.

## Key Files

```
src/
├── api/
│   ├── main.py                    # FastAPI app, routes
│   └── narrative_endpoints.py     # LLM narrative generation endpoints
├── analysis/
│   └── bill_narrator.py           # Claude prompts for narratives
├── graph/
│   └── neo4j_store.py             # Neo4j queries
├── narrative/
│   └── generator.py               # Topic grouping, CHIPS story generation
└── web/
    └── templates/
        └── index.html             # Single-page UI (Tailwind + vanilla JS)

scripts/
├── migrate_to_aura.py             # Migration from local Neo4j to Aura
├── fix_section_names_aura.py      # Fix script we just ran
└── export_for_aura.py             # Export script

docs/
├── council-feedback-2026-01-22.md # Detailed expert feedback on product
└── handoff-2026-01-22.md          # This file
```

## Caching Behavior

The narrative endpoints cache LLM responses in `data/cache/` for 24 hours. To regenerate:
- Add `?regenerate=true` to any `/narrative/*` endpoint
- Or restart the Railway deployment to clear filesystem

Cache files:
- `chips_executive_summary.json`
- `chips_navigation.json`
- `chips_full_narrative.json`
- `section_*.json`

## Testing Locally

```bash
cd /Users/austincarson/Documents/SBC/legislative-intelligence

# Need local Neo4j running OR use Aura credentials in .env
export NEO4J_URI="neo4j+s://e7a8cfe8.databases.neo4j.io"
export NEO4J_USER="neo4j"
export NEO4J_PASSWORD="NHHlBSq44JEheHQIGABcBAC74G-Ej6FPOjJYPSqJKNw"
export ANTHROPIC_API_KEY="sk-ant-..."  # Ask Austin

uvicorn src.api.main:app --reload --port 8000
```

## Suggested Starting Point

The most impactful next step is probably **fixing the section modal/detail view** since it's the main interaction point and currently broken. Start by:

1. Testing the endpoint directly: `curl "https://legislative-intelligence-production.up.railway.app/narrative/section/42%20USC%2018911"`
2. Checking if it's a timeout, error, or empty response
3. Looking at `bill_narrator.py` `generate_section_context()` method
4. Consider adding better error handling and fallbacks in the UI
